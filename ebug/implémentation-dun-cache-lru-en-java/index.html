<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Implémentation d&#39;un cache LRU en Java | Mon Blog</title>
<meta name="keywords" content="java, algorithmique, cache, performance">
<meta name="description" content="Comment implémenter efficacement un cache LRU (Least Recently Used) en Java avec LinkedHashMap">
<meta name="author" content="Gaëtan Bouget">
<link rel="canonical" href="http://localhost:1313/impl%C3%A9mentation-dun-cache-lru-en-java/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css" integrity="sha256-j&#43;ECM6cGvIfy4Is8&#43;XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/impl%C3%A9mentation-dun-cache-lru-en-java/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/impl%C3%A9mentation-dun-cache-lru-en-java/">
  <meta property="og:site_name" content="Mon Blog">
  <meta property="og:title" content="Implémentation d&#39;un cache LRU en Java">
  <meta property="og:description" content="Comment implémenter efficacement un cache LRU (Least Recently Used) en Java avec LinkedHashMap">
  <meta property="og:locale" content="fr-FR">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-07-19T14:30:00+02:00">
    <meta property="article:modified_time" content="2025-07-19T14:30:00+02:00">
    <meta property="article:tag" content="Java">
    <meta property="article:tag" content="Algorithmique">
    <meta property="article:tag" content="Cache">
    <meta property="article:tag" content="Performance">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Implémentation d&#39;un cache LRU en Java">
<meta name="twitter:description" content="Comment implémenter efficacement un cache LRU (Least Recently Used) en Java avec LinkedHashMap">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Implémentation d'un cache LRU en Java",
      "item": "http://localhost:1313/impl%C3%A9mentation-dun-cache-lru-en-java/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Implémentation d'un cache LRU en Java",
  "name": "Implémentation d\u0027un cache LRU en Java",
  "description": "Comment implémenter efficacement un cache LRU (Least Recently Used) en Java avec LinkedHashMap",
  "keywords": [
    "java", "algorithmique", "cache", "performance"
  ],
  "articleBody": "Implémentation d’un cache LRU en Java Le cache LRU (Least Recently Used) est une stratégie d’éviction couramment utilisée dans les systèmes informatiques. Lorsque le cache atteint sa capacité maximale, l’élément le moins récemment utilisé est supprimé pour faire place au nouveau.\nPrincipe de fonctionnement L’algorithme LRU maintient un ordre des éléments basé sur leur utilisation récente.\nChaque fois qu’un élément est accédé ou ajouté, il devient le plus récemment utilisé.\nCette approche améliore les performances en gardant les données fréquemment utilisées facilement accessibles.\nImplémentation avec LinkedHashMap Java propose une solution élégante avec LinkedHashMap, qui maintient l’ordre d’insertion ou d’accès, tout en offrant un accès en temps constant O(1).\nCode Java import java.util.LinkedHashMap; import java.util.Map; public class LRUCache\u003cK, V\u003e extends LinkedHashMap\u003cK, V\u003e { private final int maxCapacity; public LRUCache(int capacity) { // accessOrder = true pour ordre d'accès au lieu d'insertion super(capacity + 1, 0.75f, true); this.maxCapacity = capacity; } @Override protected boolean removeEldestEntry(Map.Entry\u003cK, V\u003e eldest) { return size() \u003e maxCapacity; } public V get(Object key) { return super.get(key); } public V put(K key, V value) { return super.put(key, value); } } Exemple d’utilisation Voici comment utiliser notre cache LRU dans une application :\npublic class CacheExample { public static void main(String[] args) { LRUCache\u003cString, Integer\u003e cache = new LRUCache\u003c\u003e(3); // Ajout d'éléments cache.put(\"A\", 1); cache.put(\"B\", 2); cache.put(\"C\", 3); System.out.println(\"Cache initial: \" + cache); // Sortie: {A=1, B=2, C=3} // Accès à \"A\" - devient le plus récent cache.get(\"A\"); System.out.println(\"Après get(A): \" + cache); // Sortie: {B=2, C=3, A=1} // Ajout d'un nouvel élément - \"B\" sera évincé cache.put(\"D\", 4); System.out.println(\"Après put(D,4): \" + cache); // Sortie: {C=3, A=1, D=4} } } Complexité temporelle Cette implémentation offre une complexité optimale :\nInsertion : O(1) Recherche : O(1) Suppression : O(1) Cas d’usage pratiques Le cache LRU est particulièrement efficace pour :\nLes caches de pages web dans les navigateurs La gestion de buffers en base de données Les systèmes de mise en cache d’API L’optimisation d’accès aux ressources coûteuses Conclusion L’utilisation de LinkedHashMap avec le paramètre accessOrder permet d’implémenter un cache LRU robuste en quelques lignes de code.\nCette solution tire parti des optimisations internes de Java tout en restant simple à maintenir et à comprendre.\nCette approche constitue un excellent compromis entre performance et simplicité pour la plupart des applications nécessitant un mécanisme de cache efficace.\n",
  "wordCount" : "386",
  "inLanguage": "en",
  "datePublished": "2025-07-19T14:30:00+02:00",
  "dateModified": "2025-07-19T14:30:00+02:00",
  "author":{
    "@type": "Person",
    "name": "Gaëtan Bouget"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/impl%C3%A9mentation-dun-cache-lru-en-java/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Mon Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Mon Blog (Alt + H)">Mon Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Implémentation d&#39;un cache LRU en Java
    </h1>
    <div class="post-description">
      Comment implémenter efficacement un cache LRU (Least Recently Used) en Java avec LinkedHashMap
    </div>
    <div class="post-meta"><span title='2025-07-19 14:30:00 +0200 CEST'>July 19, 2025</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Gaëtan Bouget

</div>
  </header> 
  <div class="post-content"><h1 id="implémentation-dun-cache-lru-en-java">Implémentation d&rsquo;un cache LRU en Java<a hidden class="anchor" aria-hidden="true" href="#implémentation-dun-cache-lru-en-java">#</a></h1>
<p>Le cache <strong>LRU</strong> (<em>Least Recently Used</em>) est une stratégie d&rsquo;éviction couramment utilisée dans les systèmes informatiques. Lorsque le cache atteint sa capacité maximale, l&rsquo;élément <strong>le moins récemment utilisé</strong> est supprimé pour faire place au nouveau.</p>
<h2 id="principe-de-fonctionnement">Principe de fonctionnement<a hidden class="anchor" aria-hidden="true" href="#principe-de-fonctionnement">#</a></h2>
<p>L&rsquo;algorithme LRU maintient un <strong>ordre des éléments basé sur leur utilisation récente</strong>.<br>
Chaque fois qu&rsquo;un élément est accédé ou ajouté, il devient le plus récemment utilisé.<br>
Cette approche améliore les performances en gardant les données fréquemment utilisées facilement accessibles.</p>
<h2 id="implémentation-avec-linkedhashmap">Implémentation avec <code>LinkedHashMap</code><a hidden class="anchor" aria-hidden="true" href="#implémentation-avec-linkedhashmap">#</a></h2>
<p>Java propose une solution élégante avec <code>LinkedHashMap</code>, qui maintient l&rsquo;ordre d&rsquo;insertion <strong>ou</strong> d&rsquo;accès, tout en offrant un accès en <strong>temps constant O(1)</strong>.</p>
<h3 id="code-java">Code Java<a hidden class="anchor" aria-hidden="true" href="#code-java">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.LinkedHashMap;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Map;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LRUCache</span><span style="color:#f92672">&lt;</span>K, V<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">extends</span> LinkedHashMap<span style="color:#f92672">&lt;</span>K, V<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> maxCapacity;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">LRUCache</span>(<span style="color:#66d9ef">int</span> capacity) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// accessOrder = true pour ordre d&#39;accès au lieu d&#39;insertion</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span>(capacity <span style="color:#f92672">+</span> 1, 0.<span style="color:#a6e22e">75f</span>, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">maxCapacity</span> <span style="color:#f92672">=</span> capacity;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">removeEldestEntry</span>(Map.<span style="color:#a6e22e">Entry</span><span style="color:#f92672">&lt;</span>K, V<span style="color:#f92672">&gt;</span> eldest) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> size() <span style="color:#f92672">&gt;</span> maxCapacity;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> V <span style="color:#a6e22e">get</span>(Object key) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">super</span>.<span style="color:#a6e22e">get</span>(key);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> V <span style="color:#a6e22e">put</span>(K key, V value) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">super</span>.<span style="color:#a6e22e">put</span>(key, value);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="exemple-dutilisation">Exemple d&rsquo;utilisation<a hidden class="anchor" aria-hidden="true" href="#exemple-dutilisation">#</a></h2>
<p>Voici comment utiliser notre cache LRU dans une application :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CacheExample</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        LRUCache<span style="color:#f92672">&lt;</span>String, Integer<span style="color:#f92672">&gt;</span> cache <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LRUCache<span style="color:#f92672">&lt;&gt;</span>(3);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Ajout d&#39;éléments</span>
</span></span><span style="display:flex;"><span>        cache.<span style="color:#a6e22e">put</span>(<span style="color:#e6db74">&#34;A&#34;</span>, 1);
</span></span><span style="display:flex;"><span>        cache.<span style="color:#a6e22e">put</span>(<span style="color:#e6db74">&#34;B&#34;</span>, 2);
</span></span><span style="display:flex;"><span>        cache.<span style="color:#a6e22e">put</span>(<span style="color:#e6db74">&#34;C&#34;</span>, 3);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Cache initial: &#34;</span> <span style="color:#f92672">+</span> cache);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Sortie: {A=1, B=2, C=3}</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Accès à &#34;A&#34; - devient le plus récent</span>
</span></span><span style="display:flex;"><span>        cache.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;A&#34;</span>);
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Après get(A): &#34;</span> <span style="color:#f92672">+</span> cache);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Sortie: {B=2, C=3, A=1}</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Ajout d&#39;un nouvel élément - &#34;B&#34; sera évincé</span>
</span></span><span style="display:flex;"><span>        cache.<span style="color:#a6e22e">put</span>(<span style="color:#e6db74">&#34;D&#34;</span>, 4);
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Après put(D,4): &#34;</span> <span style="color:#f92672">+</span> cache);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Sortie: {C=3, A=1, D=4}</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="complexité-temporelle">Complexité temporelle<a hidden class="anchor" aria-hidden="true" href="#complexité-temporelle">#</a></h2>
<p>Cette implémentation offre une complexité optimale :</p>
<ul>
<li><strong>Insertion</strong> : <code>O(1)</code></li>
<li><strong>Recherche</strong> : <code>O(1)</code></li>
<li><strong>Suppression</strong> : <code>O(1)</code></li>
</ul>
<h2 id="cas-dusage-pratiques">Cas d&rsquo;usage pratiques<a hidden class="anchor" aria-hidden="true" href="#cas-dusage-pratiques">#</a></h2>
<p>Le cache LRU est particulièrement efficace pour :</p>
<ul>
<li>Les <strong>caches de pages web</strong> dans les navigateurs</li>
<li>La <strong>gestion de buffers</strong> en base de données</li>
<li>Les <strong>systèmes de mise en cache d&rsquo;API</strong></li>
<li>L&rsquo;optimisation d&rsquo;accès aux <strong>ressources coûteuses</strong></li>
</ul>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>L&rsquo;utilisation de <code>LinkedHashMap</code> avec le paramètre <code>accessOrder</code> permet d&rsquo;implémenter un <strong>cache LRU robuste</strong> en quelques lignes de code.<br>
Cette solution tire parti des <strong>optimisations internes de Java</strong> tout en restant simple à maintenir et à comprendre.</p>
<p>Cette approche constitue un excellent compromis entre <strong>performance</strong> et <strong>simplicité</strong> pour la plupart des applications nécessitant un mécanisme de cache efficace.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/java/">Java</a></li>
      <li><a href="http://localhost:1313/tags/algorithmique/">Algorithmique</a></li>
      <li><a href="http://localhost:1313/tags/cache/">Cache</a></li>
      <li><a href="http://localhost:1313/tags/performance/">Performance</a></li>
    </ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Mon Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
